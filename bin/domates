#!/usr/bin/env python3
# domates --- command-line pomodoro timer

import gi

gi.require_version('Notify', '0.7')

from gi.repository import Notify
from time import sleep

# TODO(2019-11-02): command line options to modify these
count = 0
pomodoro_secs = 25 * 60
short_break_secs = 5 * 60
long_break_secs = 15 * 60
pomodoros_for_short_break = 2
pomodoros_for_long_break = 4

Notify.init("Domates")

def _tell(message):
    print(message)
    n = Notify.Notification.new("Domates", message)
    n.set_urgency(1)            # mid-level
    n.show()

try:
    while True:
        _tell(f"Start pomodoro #{count + 1}")
        sleep(pomodoro_secs)
        c = count
        count += 1
        print("Hit Enter to start break timer", end=''); input()
        if c > 0 and (c % 4) == 0:
            _tell("Start long break")
            sleep(long_break_secs)
        else:
            _tell("Start short break")
            sleep(short_break_secs)
        _tell("Break complete")
        print("Hit Enter to start new pomodoro", end=''); input()
except KeyboardInterrupt:
    print(f"\nExit with KeyboardInterrupt, completed {count} pomodoro(s) so far")
    exit()
