# i3 configuration

### General settings:
set $mod Mod4
set $hyp Mod3
set $fnt pango:Iosevka Cadadrish Sans 12
font $fnt
floating_modifier $mod
workspace_layout default
focus_follows_mouse yes
focus_on_window_activation urgent
title_align center
hide_edge_borders none

# show title bars
# for_window [class=".*"] border normal

# hide title bars
for_window [class=".*"] border pixel 3

# i3-gaps
gaps inner      15
gaps outer      5
gaps horizontal 15
gaps vertical   10

### i3-specific background processes:
exec python3 $MYLIB/i3/autotile.py -w 1 3

### Global parameters
set $terminal kitty

### Launchers:
bindsym F12 exec --no-startup-id i3-dmenu-desktop
bindsym Shift+F12 exec --no-startup-id rofi -show run
bindsym $mod+Shift+Return exec emacsclient -c
bindsym $mod+Return exec $terminal
bindsym $mod+Control+Return exec --no-startup-id firefox --new-window
bindsym $mod+h exec --no-startup-id sh $MYLIB/i3/i3cheatsheet.sh
bindsym $mod+Control+y exec --no-startup-id xtype.sh
bindsym $mod+Control+f exec --no-startup-id Thunar
bindsym $mod+Control+w exec --no-startup-id ffprofile.sh
bindsym $mod+Control+p exec --no-startup-id passmenu.sh
bindsym $mod+Control+e exec $terminal -e 'less /run/user/$UID/i3/errorlog.*'
bindsym $mod+Control+x exec $terminal -e 'less ~/.xsession-errors'
bindsym $mod+Control+Shift+q exit
bindsym $mod+Shift+semicolon exec i3-input -P 'i3 command: '
bindsym $mod+w exec --no-startup-id i3switch.rb
bindsym $mod+BackSpace exec --no-startup-id python3 $MYLIB/i3/focus-last.py --switch
bindsym $mod+Control+t exec --no-startup-id sh $MYLIB/toggle-tapping.sh
bindsym $mod+Next exec --no-startup-id pkill -USR1 -f setbg.bash
bindsym $mod+Prior exec --no-startup-id pkill -USR2 -f setbg.bash
bindsym $mod+q exec --no-startup-id qrclip.sh
bindsym Print exec --no-startup-id flameshot gui
bindsym $mod+Tab exec --no-startup-id i3-workspace-finder.bash
bindsym $mod+Shift+Tab exec --no-startup-id i3-move-to-workspace.bash

### Window management keybindings:
bindsym $mod+b focus left
bindsym $mod+n focus down
bindsym $mod+p focus up
bindsym $mod+f focus right

bindsym $mod+Shift+b move left
bindsym $mod+Shift+n move down
bindsym $mod+Shift+p move up
bindsym $mod+Shift+f move right

bindsym F11 fullscreen toggle
bindsym $mod+2 split v
bindsym $mod+3 split h

bindsym $mod+s layout stacking
bindsym $mod+t layout tabbed
bindsym $mod+1 layout toggle split
bindsym $mod+semicolon floating toggle
bindsym $mod+comma move scratchpad
bindsym $mod+period scratchpad show

# change focus between tiling / floating windows
bindsym $mod+space focus mode_toggle

bindsym $mod+u focus parent
bindsym $mod+c focus child

bindsym $mod+g reload
bindsym $mod+Shift+g restart
bindsym $mod+k kill

### Workspaces:
set $ws1 "ùç†üî¥"
set $ws2 "ùç°üîµ"
set $ws3 "ùç¢üü°"
set $ws4 "ùç£üü¢"
set $ws5 "ùç§‚ö™"

bindsym F1 workspace $ws1
bindsym F2 workspace $ws2
bindsym F3 workspace $ws3
bindsym F4 workspace $ws4
bindsym F5 workspace $ws5

bindsym Shift+F1 move container to workspace $ws1
bindsym Shift+F2 move container to workspace $ws2
bindsym Shift+F3 move container to workspace $ws3
bindsym Shift+F4 move container to workspace $ws4
bindsym Shift+F5 move container to workspace $ws5

### Multiple monitors:

# Move workspaces between monitors.
bindsym $mod+Right move workspace to output right
bindsym $mod+Left move workspace to output left
bindsym $mod+Up move workspace to output up
bindsym $mod+Down move workspace to output down

### Modes:
# power management
# from: https://wiki.archlinux.org/index.php/I3
set $Locker xset s activate
bindsym $mod+l exec --no-startup-id $Locker, mode "default"
set $mode_system System (l) lock, (e) logout, (s) suspend, (h) hibernate, (Shift+r) reboot, (Shift+s) shutdown
mode "$mode_system" {
    bindsym l exec --no-startup-id $Locker, mode "default"
    bindsym e exec --no-startup-id i3-msg exit, mode "default"
    bindsym s exec --no-startup-id $Locker && systemctl suspend, mode "default"
    bindsym h exec --no-startup-id $Locker && systemctl hibernate, mode "default"
    bindsym Shift+r exec --no-startup-id systemctl reboot, mode "default"
    bindsym Shift+s exec --no-startup-id systemctl poweroff -i, mode "default"

    # exit mode
    bindsym Return mode "default"
    bindsym Escape mode "default"
    bindsym Control+g mode "default"
}
bindsym Pause mode "$mode_system"

# manual management of external displays
# from: https://wiki.archlinux.org/index.php/I3
set $mode_display Ext Screen (h) HDMI ON, (H) HDMI OFF, (s) HDMI Sound ON, (S) HDMI Sound OFF
mode "$mode_display" {
    bindsym h exec --no-startup-id xrandr --output HDMI1 --auto --right-of LVDS1, mode "default"
    bindsym y exec --no-startup-id xrandr --output HDMI1 --auto --off, mode "default"
    bindsym s exec --no-startup-id pactl set-card-profile 0 output:hdmi-stereo
    bindsym S exec --no-startup-id pactl set-card-profile 0 output:analog-stereo

    # exit mode
    bindsym Return mode "default"
    bindsym Escape mode "default"
    bindsym Control+g mode "default"
}
# Declare here the shortcut to bring the display selection menu
bindsym F10 mode "$mode_display"

set $mode_brightness Set brightness 1..9 = 10..90%, 0 = 100%, i/d = inc/dec by 5%
mode "$mode_brightness" {
    bindsym 1 exec xbacklight -set 10
    bindsym 2 exec xbacklight -set 20
    bindsym 3 exec xbacklight -set 30
    bindsym 4 exec xbacklight -set 40
    bindsym 5 exec xbacklight -set 50
    bindsym 6 exec xbacklight -set 60
    bindsym 7 exec xbacklight -set 70
    bindsym 8 exec xbacklight -set 80
    bindsym 9 exec xbacklight -set 90
    bindsym 0 exec xbacklight -set 100
    bindsym i exec xbacklight -inc 5
    bindsym d exec xbacklight -dec 5

    # exit mode
    bindsym Return mode "default"
    bindsym Escape mode "default"
    bindsym Control+g mode "default"
}
bindsym $mod+Control+b mode "$mode_brightness"

set $mode_pass Passthrough, Ctrl+G to exit
mode "$mode_pass" {
    bindsym Control+g mode "default"
}
bindsym $mod+Control+space mode "$mode_pass"

set $mode_kbdselect Select keyboard layout: (f) = tr F, (g) = gb Q, (t) = tr Q
mode "$mode_kbdselect" {
    bindsym f exec setxkbmap -option 'ctrl:nocaps' tr f; mode "default"
    bindsym g exec setxkbmap -option 'ctrl:nocaps' gb; mode "default"
    bindsym t exec setxkbmap -option 'ctrl:nocaps' tr; mode "default"

    bindsym Return mode "default"
    bindsym Escape mode "default"
    bindsym Control+g mode "default"
}
bindsym $mod+Control+k mode "$mode_kbdselect"

# Pulse Audio controls
bindsym XF86AudioRaiseVolume exec volset.bash up
bindsym XF86AudioLowerVolume exec volset.bash down
bindsym XF86AudioMute        exec volset.bash toggle-mute

set $mod_volume Set volume (i)ncrease / (d)ecrease / (m)ute
mode "$mod_volume" {
    bindsym i exec volset.bash up
    bindsym d exec volset.bash down
    bindsym f exec volset.bash full
    bindsym m exec volset.bash toggle-mute

    bindsym Return mode "default"
    bindsym Escape mode "default"
    bindsym Control+g mode "default"
}
bindsym $mod+Control+s mode "$mod_volume"

# resize window (you can also use the mouse for that)
set $mod_resize Resize with arrow keys
mode "$mod_resize" {
        # we want to be able to switch windows while resizing.
        bindsym b focus left
        bindsym n focus down
        bindsym p focus up
        bindsym f focus right

        bindsym Left  resize shrink width 10 px or 10 ppt
        bindsym Down  resize grow height 10 px or 10 ppt
        bindsym Up    resize shrink height 10 px or 10 ppt
        bindsym Right resize grow width 10 px or 10 ppt

        # might be useful when resizing.
        bindsym F11 fullscreen toggle
        bindsym semicolon floating toggle

        # back to normal: Enter or Escape or Ctrl+g
        bindsym Return mode "default"
        bindsym Escape mode "default"
        bindsym Control+g mode "default"
}
bindsym $mod+r mode "$mod_resize"

# Scrolling without my fingers dying.

# Sleep needed because:
# https://github.com/jordansissel/xdotool/issues/210#issuecomment-406158785
set $xdotool_press_key exec xdotool sleep 0.15 getactivewindow key --clearmodifiers

set $mod_scroll_emacs Emacs-like scroll
mode "$mod_scroll_emacs" {
        bindsym n $xdotool_press_key Down
        bindsym p $xdotool_press_key Up
        bindsym f $xdotool_press_key Right
        bindsym b $xdotool_press_key Left

        bindsym Control+v $xdotool_press_key Next
        bindsym Mod1+v $xdotool_press_key Prior

        bindsym a $xdotool_press_key Home
        bindsym e $xdotool_press_key End

        bindsym Tab $xdotool_press_key ctrl+Tab
        bindsym BackSpace $xdotool_press_key ctrl+shift+Tab

        # Go to mouse mode
        bindsym m mode "$mod_mouse_emacs"

        # back to normal: Enter or Escape or Ctrl+g
        bindsym Return mode "default"
        bindsym Escape mode "default"
        bindsym Control+g mode "default"
}
bindsym $mod+v mode "$mod_scroll_emacs"

# Move the mouse cursor around with keyboard.

set $mod_mouse_emacs Emacs-like bindings for mousey mousey
mode "$mod_mouse_emacs" {
        # ‚Äò--polar‚Äô means "angle distance", angle starts 0=top and
        # moves clockwise.
        bindsym n exec xdotool mousemove_relative --polar 180 25
        bindsym p exec xdotool mousemove_relative --polar 0   25
        bindsym f exec xdotool mousemove_relative --polar 90  25
        bindsym b exec xdotool mousemove_relative --polar 270 25
        bindsym q exec xdotool mousemove_relative --polar 315 25
        bindsym e exec xdotool mousemove_relative --polar 45  25
        bindsym z exec xdotool mousemove_relative --polar 225 25
        bindsym c exec xdotool mousemove_relative --polar 135 25

        # Fine-grain movement
        bindsym Control+n exec xdotool mousemove_relative --polar 180 5
        bindsym Control+p exec xdotool mousemove_relative --polar 0   5
        bindsym Control+f exec xdotool mousemove_relative --polar 90  5
        bindsym Control+b exec xdotool mousemove_relative --polar 270 5
        bindsym Control+q exec xdotool mousemove_relative --polar 315 5
        bindsym Control+e exec xdotool mousemove_relative --polar 45  5
        bindsym Control+z exec xdotool mousemove_relative --polar 225 5
        bindsym Control+c exec xdotool mousemove_relative --polar 135 5

        # Coarse-grain movement
        bindsym Shift+n exec xdotool mousemove_relative --polar 180 50
        bindsym Shift+p exec xdotool mousemove_relative --polar 0   50
        bindsym Shift+f exec xdotool mousemove_relative --polar 90  50
        bindsym Shift+b exec xdotool mousemove_relative --polar 270 50
        bindsym Shift+q exec xdotool mousemove_relative --polar 315 50
        bindsym Shift+e exec xdotool mousemove_relative --polar 45  50
        bindsym Shift+z exec xdotool mousemove_relative --polar 225 50
        bindsym Shift+c exec xdotool mousemove_relative --polar 135 50

        # Coarser-grain movement
        bindsym Mod1+n exec xdotool mousemove_relative --polar 180 100
        bindsym Mod1+p exec xdotool mousemove_relative --polar 0   100
        bindsym Mod1+f exec xdotool mousemove_relative --polar 90  100
        bindsym Mod1+b exec xdotool mousemove_relative --polar 270 100
        bindsym Mod1+q exec xdotool mousemove_relative --polar 315 100
        bindsym Mod1+e exec xdotool mousemove_relative --polar 45  100
        bindsym Mod1+z exec xdotool mousemove_relative --polar 225 100
        bindsym Mod1+c exec xdotool mousemove_relative --polar 135 100

        # Clickety clackety
        bindsym space exec xdotool click 1
        bindsym Shift+space   exec xdotool click --clearmodifiers 2
        bindsym Control+space exec xdotool click --clearmodifiers 3
        bindsym Mod1+space    exec xdotool click --clearmodifiers --repeat 2 1

        # Wheel
        bindsym j exec xdotool click --clearmodifiers 5
        bindsym k exec xdotool click --clearmodifiers 4
        # These don‚Äôt work very well for some reason...
        # bindsym Shift+j exec xdotool click --clearmodifiers --repeat 10 5
        # bindsym Shift+k exec xdotool click --clearmodifiers --repeat 10 4

        # Go to scroll mode
        bindsym v mode "$mod_scroll_emacs"

        # back to normal: Enter or Escape or Ctrl+g
        bindsym Return mode "default"
        bindsym Escape mode "default"
        bindsym Control+g mode "default"
}
bindsym $mod+m mode "$mod_mouse_emacs"

include colours_active_theme

### Window Rules:
#### Praat:
for_window [title="Praat Objects"] split h
for_window [title="Praat Picture"] move to container [title="Praat Objects"]
for_window [class="Praat" title="SoundRecorder"] floating enable
for_window [class="Praat" title="^\d+"] floating enable
for_window [class="Praat" title="VowelEditor"] floating enable
for_window [class="Praat" title="Praat Info"] floating enable
for_window [class="Praat" title="^Script"] floating enable
for_window [class="Praat" title="untitled script"] floating enable

#### Zotero:
# new dialog
# for some reason setting the class/instance breaks things and I can't
# seem to make this vertically center the window.
for_window [title="Quick Format Citation"] floating enable move position center
# classic dialog
for_window [title="Add/Edit Citation" class="Zotero"] floating enable move position center

#### TeXDoctk:
for_window [title="File search results for .*"] floating enable

#### Matplotlib:
for_window [class="Matplotlib"] floating enable

#### Network Manager:
for_window [class="Nm-connection-editor"] floating enable

#### PulseAudio controller:
for_window [class="Pavucontrol"] floating enable

#### R:
for_window [class="R_x11"] floating enable

#### Editor command for Qutebrowser:
for_window [class="qtbedit"] floating enable move position center

#### Telegram client:
for_window [title="Telegram( \(\d+\))?"] floating enable move position center

#### ImageMagick
for_window [class="Display-im[0-9]\.q.*"] floating enable move position center

